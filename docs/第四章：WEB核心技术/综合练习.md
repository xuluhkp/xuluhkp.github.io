# 今日内容介绍
<extoc></extoc>

# 准备工作
## 页面调整
### 修改`list.jsp`页面
#### 搜索栏
```html
<!--搜索栏-->
<div style="float: left;">
    <form class="form-inline">
        <div class="form-group">
            <label for="exampleInputName2">姓名</label>
            <input type="text" class="form-control" id="exampleInputName2" >
        </div>
        <div class="form-group">
            <label for="exampleInputName3">籍贯</label>
            <input type="text" class="form-control" id="exampleInputName3" >
        </div>

        <div class="form-group">
            <label for="exampleInputEmail2">邮箱</label>
            <input type="email" class="form-control" id="exampleInputEmail2"  >
        </div>
        <button type="submit" class="btn btn-default">查询</button>
    </form>
</div>
```

#### 按钮
```html
<!--按钮-->
<div style="float: right;margin: 5px;">
    <a class="btn btn-primary" href="add.html">添加联系人</a>
    <a class="btn btn-primary" href="add.html">删除选中</a>
</div>
```

#### 分页条
```html
<!--分页条-->
<div>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li>
                <a href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li>
                <a href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            <span style="font-size: 25px;margin-left: 5px;">
                共16条记录，共4页
            </span>

        </ul>
    </nav>
</div>
```

### 修改HTML页面为JSP

## 数据库修改,添加用户名或密码字段
```sql
create database web12; -- 创建数据库
use web12; 			   -- 使用数据库
create table user(   -- 创建表
  id int primary key auto_increment,
  name varchar(20) not null,
  gender varchar(5),
  age int,
  address varchar(32),
  qq	varchar(20),
  email varchar(50),
  username varchar(20) unique not null,
  password varchar(20) not null
);
```

## 修改实体类`User`,添加用户名或密码属性
```java
package com.itheima.bean;

public class User {
    private int id ;
    private String name ;
    private String gender;
    private int age ;
    private String address ;
    private String qq ;
    private String email;

    private String username;
    private String password;

    //get和set方法省略......
}
```

# 用户登录功能
## 登录页面表单项name属性值修改

注意:`name`属性值应该与`User`类中的属性保持一致

## 登录页面验证码引入

![](assets/markdown-img-paste-20180803113431890.png)

```javascript
<script type="text/javascript">
//验证码看不清换一张
function refreshCode() {
  document.getElementById("vcode").src = "${pageContext.request.contextPath}/code?time="+new Date().getTime();
    }
</script>
```

## 登录代码实现
### web层(servlet)
#### 基本步骤
```java
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    //1. 解决中文乱码问题

    //2. 接收用户登录参数

    //3. 封装数据

    //4. 完成验证码校验
    //4.1 校验失败,保存错误信息,转发到登录页面

    //5. 调用业务层完成登录操作

    //6. 根据登录结果跳转页面
    //6.1 登录失败,跳转登录页面,展示错误信息
    //6.2 登录成功,保存用户信息到session,跳转首页,展示用户信息
}
```
#### 代码实现
```java
@WebServlet("/login")
public class UserLoginServelt extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 解决中文乱码问题
        request.setCharacterEncoding("UTF-8");
        //2. 接收用户登录参数
        Map<String, String[]> params = request.getParameterMap();
        //3. 封装数据
        User user = new User();
        try {
            BeanUtils.populate(user,params);
        } catch (Exception e) {
            e.printStackTrace();
        }

        //4. 完成验证码校验
        //获取用户输入的验证码
        String verifycode = request.getParameter("verifycode");
        //获取session中的验证码
        String checkcode = (String) request.getSession().getAttribute("checkcode");
        //4.1 校验失败,保存错误信息,转发到登录页面
        if(verifycode==null || checkcode==null || !verifycode.equalsIgnoreCase(checkcode)){
            request.setAttribute("msg","验证码输入错误");
            request.getRequestDispatcher("/login.jsp").forward(request,response);
            return;
        }

        //5. 调用业务层完成登录操作
        UserService userService = new UserServiceImpl();
        User loginedUser = userService.login(user);
        //6. 根据登录结果跳转页面
        if(loginedUser==null){
            //6.1 登录失败,跳转登录页面,展示错误信息
            request.setAttribute("msg","用户名或密码错误");
            request.getRequestDispatcher("/login.jsp").forward(request,response);
            return ;
        }

        //6.2 登录成功,保存用户信息到session,跳转首页,展示用户信息
        request.getSession().setAttribute("loginedUser",loginedUser);
        response.sendRedirect(request.getContextPath()+"/index.jsp");
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doPost(request, response);
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 用户登录功能
 * @param user 封装了用户输入的用户名和密码的用户对象
 * @return 登录成功的用户对象或者null
 */
User login(User user);
```

#### 实现类`UserServiceImpl`
```java
@Override
public User login(User user) {
    return userDao.findByUsernameAndPassword(user);
}
```

### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 根据用户名或密码查询数据库
 * @param user  封装了用户名和密码
 * @return user对象或者null
 */
User findByUsernameAndPassword(User user);
```
#### 实现类`UserDaoImpl`
```java
@Override
public User findByUsernameAndPassword(User user) {
    //定义sql语句
    String sql = "select * from user where username = ? and password = ? ";
    try {
        //根据用户名或密码进行查询
        User  loginedUser= template.queryForObject(sql, new BeanPropertyRowMapper<User>(User.class), user.getUsername(), user.getPassword());
        return loginedUser;
    } catch (DataAccessException e) {
        e.printStackTrace();
        return null;
    }
}
```

### 页面数据展示
#### 登录失败,错误信息展示`login.jsp`
![](assets/markdown-img-paste-20180803134010426.png)

#### 登录成功,用户信息展示
![](assets/markdown-img-paste-20180803132344656.png)

# 用户添加功能
## 分析
![](assets/markdown-img-paste-20180803141705868.png)

## 实现
### 添加联系人页面`add.jsp`
![](assets/markdown-img-paste-20180803144209233.png)

**注意:确定各个表单项的`name`属性的值与`User`实体的属性名称一致**


### web层(servlet)
```java
@WebServlet("/user/add")
public class UserAddServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 解决中文乱码问题
        request.setCharacterEncoding("UTF-8");
        //2. 接收参数
        Map<String, String[]> params = request.getParameterMap();
        //3. 封装数据
        User user = new User();
        try {
            BeanUtils.populate(user,params);
        } catch (Exception e) {
            e.printStackTrace();
        }
        //4. 调用业务层完成添加操作
        UserService userService = new UserServiceImpl();
        userService.addUser(user);
        //5. 跳转页面,用户列表页面
        response.sendRedirect(request.getContextPath()+"/user/list");
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 添加联系人
 * @param user 封装联系人信息
 */
void addUser(User user);
```

#### 实现类`UserServiceImpl`
```java
@Override
public void addUser(User user) {
    userDao.add(user);
}
```
### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 添加用户
 * @param user  封装用户信息的对象
 */
void add(User user);
```

#### 实现类`UserDaoImpl`
```java
@Override
public void add(User user) {
    String sql = "insert into user values (null,?,?,?,?,?,?,?,?)";
    template.update(sql,user.getName(),user.getGender(),user.getAge(),user.getAddress(),user.getQq(),user.getEmail(),user.getUsername(),user.getPassword());
}
```

# 用户删除功能
## 分析
![](assets/markdown-img-paste-20180803144940104.png)
## 代码实现
### 列表页面`list.jsp`

![](assets/markdown-img-paste-20180803145441462.png)

```javascript
function delUser(id) {
    //用户安全提示
    if(confirm("您确定要删除吗？")){
        //访问路径
        location.href="${pageContext.request.contextPath}/user/del?id="+id;
    }
}
```

### web层(servlet)
```java
@WebServlet("/user/del")
public class UserDelServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 接收参数
        String id = request.getParameter("id");
        //2. 调用业务层处理数据
        UserService userService = new UserServiceImpl();
        userService.delUser(id);
        //3. 跳转页面
        response.sendRedirect(request.getContextPath()+"/user/list");
    }
}
```

### 业务层(service)
#### 接口`UserService`
```java
/**
 * 删除用户
 * @param id 用户id
 */
void delUser(String id);
```

#### 实现类`UserServiceImpl`
```java
@Override
public void delUser(String id) {
    userDao.deleteById(id);
}
```

### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 根据id删除用户
 * @param id 用户id
 */
void deleteById(String id);
```

#### 实现类`UserDaoImpl`
```java
@Override
public void deleteById(String id) {
    String sql = "delete from user where id = ? ";
    template.update(sql,id);
}
```

# 用户修改功能
## 分析
### 用户数据回显
![](assets/markdown-img-paste-20180803151213578.png)

### 用户数据更新
![](assets/markdown-img-paste-20180803151915798.png)

## 用户数据回显代码实现
### 页面修改`list.jsp`
![](assets/markdown-img-paste-2018080315230589.png)

### web层(service)
```java
@WebServlet("/user/findById")
public class FindUserServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 接收参数
        String id = request.getParameter("id");
        //2. 调用业务层处理数据
        UserService userService = new UserServiceImpl();
        User user = userService.findById(id);
        //4. 将数据保存到request域
        request.setAttribute("user",user);
        //5. 跳转页面
        request.getRequestDispatcher("/update.jsp").forward(request,response);
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 根据id查询用户信息
 * @param id  用户id
 * @return 查询到的用户信息
 */
User findById(String id);
```
#### 实现类`UserServiceImpl`
```java
@Override
public User findById(String id) {
    return userDao.findById(id);
}
```

### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 根据id查询用户信息
 * @param id 用户id
 * @return 查询到的用户信息
 */
User findById(String id);
```
#### 实现类`UserDaoImpl`
```java
@Override
public User findById(String id) {
    String sql = "select * from user where id = ? ";
    try {
        User user = template.queryForObject(sql, new BeanPropertyRowMapper<User>(User.class), id);
        return user;
    } catch (DataAccessException e) {
        e.printStackTrace();
        return null;
    }
}
```

### 展示数据`update.jsp`

1. 在页面使用`value`属性回显数据
![](assets/markdown-img-paste-20180803154709157.png)

2. 特别需要注意`性别`和`籍贯`项数据的回显方式
![](assets/markdown-img-paste-20180803154459699.png)
![](assets/markdown-img-paste-20180803154518129.png)

3. 表单中需要额外提供一个隐藏域,隐藏域的值为数据id
![](assets/markdown-img-paste-20180803154405339.png)


## 用户数据更新代码实现
### 页面修改`update.jsp`
![](assets/markdown-img-paste-20180803154854541.png)

### web层(service)
```java
@WebServlet("/user/update")
public class UserUpdateServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 解决掌握乱码问题
        request.setCharacterEncoding("utf-8");
        //2. 接收参数
        Map<String, String[]> params = request.getParameterMap();
        //3. 封装数据
        User user = new User();
        try {
            BeanUtils.populate(user,params);
        } catch (Exception e) {
            e.printStackTrace();
        }
        //4. 调用业务层处理数据
        UserService userService = new UserServiceImpl();
        userService.updateUser(user);
        //5. 跳转页面
        response.sendRedirect(request.getContextPath()+"/user/list");
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 更新用户信息
 * @param user  修改之后的用户信息
 */
void updateUser(User user);
```
#### 实现类`UserServiceImpl`
```java
@Override
public void updateUser(User user) {
    userDao.update(user);
}
```

### 数据访问层(dao)
#### 接口
```java
/**
 * 修改用户信息
 * @param user  用户修改之后的用户信息
 */
void update(User user);
```
#### 实现类
```java
@Override
public void update(User user) {
    String sql = "update user set  name = ? ,gender = ? ,age = ? ,address = ?,qq = ?,email = ?,username = ? ,password = ? where id = ? " ;
    template.update(sql,user.getName(),user.getGender(),user.getAge(),user.getAddress(),user.getQq(),user.getEmail(),user.getUsername(),user.getPassword(),user.getId());
}
```

# 删除选中功能
## 分析
![](assets/markdown-img-paste-20180804082505300.png)

## 代码实现
### 页面修改`list.jsp`

1. 在表格(`table`)标签外添加表单(`form`)标签
![](assets/markdown-img-paste-20180803161106342.png)

2. 给遍历的每一条数据的复选框添加`name`和`value`属性
![](assets/markdown-img-paste-20180803160822446.png)

3. 给删除选中按钮绑定事件,用户点击之后提交表单
![](assets/markdown-img-paste-20180803160915800.png)

```javascript
//删除选中用户
function delSelect() {
    //定义一个删除的标记  false代码没有删除项  true代表有删除项
    var flag = false ;
    //获取所有的复选框
    var chs = document.getElementsByName("ids");
    //设置复选框的状态与全选框一致
    for (var i = 0; i <chs.length ; i++) {
        if(chs[i].checked){
            flag = true ; //有选中的删除项  标记变为true
            break ;
        }
    }

    //用户安全提示
    if(confirm("您确定要删除吗？")) {
        //获取到数据的表单
        var form = document.getElementById("listFrom");
        //如果有选中的项,提交表单
        if(flag){
            //使用JS提交表单
            form.submit();
        }
    }
}
```

**注意:只有当用户勾选的有需要删除的用户,才需要提交表单,否则不提交**

4. 表格全选全不选功能

![](assets/markdown-img-paste-20180803163135982.png)

```javascript
//全选按钮  全选全部选功能
function selectAll(me) {
    //获取所有的复选框
    var chs = document.getElementsByName("ids");

    //设置复选框的状态与全选框一致
    for (var i = 0; i <chs.length ; i++) {
        chs[i].checked = me.checked ;
    }
}
```

### web层(service)
```java
@WebServlet("/user/delSelect")
public class UserDelSelectServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1. 接收参数   ids  --> [1,2,3]
        String[] ids = request.getParameterValues("ids");
        //2. 调用业务层处理数据
        UserService userService = new UserServiceImpl();
        userService.delSelectUsers(ids);
        //3. 跳转页面
        response.sendRedirect(request.getContextPath()+"/user/list");
    }
}
```

### 业务层(service)
#### 接口`UserService`
```java
/**
 * 删除选中用户
 * @param ids 需要被删除的用户id
 */
void delSelectUsers(String[] ids);
```

#### 实现类`UserServiceImpl`
```java
@Override
public void delSelectUsers(String[] ids) {
    userDao.deleteByIds(ids);
}
```

### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 删除用户
 * @param ids 需要被删除的用户id
 */
void deleteByIds(String[] ids);
```
#### 实现类`UserDaoImpl`
```java
@Override
public void deleteByIds(String[] ids) {
    //拼接sql语句
    StringBuilder sql = new StringBuilder("delete  from user where id in (") ;
    for (String id : ids) {
        sql.append("?,");
    }
    sql.deleteCharAt(sql.length()-1);
    sql.append(")");
    System.out.println(sql);
    //执行删除语句
    template.update(sql.toString(),ids);
}
```

# 分页查询功能
## 分析
### 分页参数与数据
![](assets/markdown-img-paste-20180803164241821.png)
### 分页步骤分析
![](assets/markdown-img-paste-20180803164522714.png)

## 代码实现
### 分页数据封装实体类`PageBean`
```java
package com.itheima.bean;

import java.util.List;

/**
 * 分页数据封装实体类
 * @param <T>
 */
public class PageBean<T> {
    private int totalCount ; //数据总条数据
    private int totalPage ;  //总页数
    private int currPage ;   //当前页
    private int rows ;        //每页显示数据条数
    private List<T> list ;    //数据列表

    //get和set方法省略....
}
```

### web层(servelt)
```java
@WebServlet("/user/page")
public class PageUserServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1.获取参数
        String currPage = request.getParameter("currPage");//当前页码
        String rows = request.getParameter("rows");//每页显示条数
        if(currPage == null || "".equals(currPage)){
            currPage = "1";
        }

        if(rows == null || "".equals(rows)){
            rows = "5";
        }

        //2.调用service查询
        UserService service = new UserServiceImpl();
        PageBean<User> pb = service.findUserByPage(currPage,rows);
        //3.将PageBean存入request
        request.setAttribute("pb",pb);
        //4.转发到list.jsp
        request.getRequestDispatcher("/list_page.jsp").forward(request,response);
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 分页查询用户信息
 * @param currPage  当前页
 * @param rows   每页显示数据行数
 * @return   分页数据
 */
PageBean<User> findUserByPage(String currPage, String rows);
```
#### 实现类`UserServiceImpl`
```java
@Override
    public PageBean<User> findUserByPage(String currPage, String rows) {
        //1.处理参数
        int cp = Integer.parseInt(currPage);
        int rs = Integer.parseInt(rows);
        if(cp <=0) {
            cp = 1;
        }
        //2.调用dao查询总记录数
        int totalCount = userDao.findTotalCount();
        //3.调用dao查询List集合
        //计算开始的记录索引
        int start = (cp - 1) * rs;
        List<User> list = userDao.findByPage(start,rs);

        //4.计算总页码
        int totalPage = (int) Math.ceil(totalCount*1.0/rs);

        //5.创建空的PageBean对象
        PageBean<User> pb = new PageBean<User>();
        //6.设置分页数据
        pb.setCurrPage(cp);
        pb.setRows(rs);
        pb.setTotalCount(totalCount);
        pb.setList(list);
        pb.setTotalPage(totalPage);

        return pb;
    }
```
### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 查询数据总条数
 * @return
 */
int findTotalCount();

/**
 * 分页查询用户数据
 * @param start  开始索引
 * @param rows   每次获取的数量
 * @return
 */
List<User> findByPage(int start, int rows);
```

#### 实现类`UserDaoImpl`
```java
@Override
public int findTotalCount() {
    String sql = "select count(*) from user ";
    int count = template.queryForObject(sql, int.class);
    return count;
}

@Override
public List<User> findByPage(int start, int rs) {
    String sql = "select * from user limit ?,?";
    return template.query(sql,new BeanPropertyRowMapper<User>(User.class),start,rs);
}
```

### 页面展示
#### 展示数据列表
![](assets/markdown-img-paste-20180803173044300.png)

#### 展示分页条
```html
<%--分页条--%>
<div>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <!--上一页-->
            <!--当前页为第一页,上一页不能点击-->
            <c:if test="${pb.currPage == 1}">
                <li class="disabled">
                    <a href="javascript:void(0);" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            </c:if>

            <!--当前页不为第一页,上一页可以点击-->
            <c:if test="${pb.currPage != 1}">
                <li>
                    <a href="${pageContext.request.contextPath}/user/page?currPage=${pb.currPage - 1}&rows=5" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
             </c:if>

            <!--页码-->
            <c:forEach begin="1" end="${pb.totalPage}" var="i" >
                <c:if test="${pb.currPage == i}">
                    <li class="active"><a href="${pageContext.request.contextPath}/user/page?currPage=${i}&rows=5">${i}</a></li>
                </c:if>
                <c:if test="${pb.currPage != i}">
                    <li><a href="${pageContext.request.contextPath}/user/page?currPage=${i}&rows=5">${i}</a></li>
                </c:if>
            </c:forEach>

            <!--下一页-->
            <!--当前页为最后一页,下一页不可点-->
            <c:if test="${pb.currPage == pb.totalPage}">
                <li class="disabled">
                    <a href="javascript:void(0);" aria-label="Previous">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </c:if>
            <!--当前页不为最后一页,下一页可点-->
            <c:if test="${pb.currPage != pb.totalPage}">
                <li>
                    <a href="${pageContext.request.contextPath}/user/page?currPage=${pb.currPage + 1}&rows=5" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </c:if>

            <span style="font-size: 25px;margin-left: 5px;">
                共${pb.totalCount}条记录，共${pb.totalPage}页
            </span>
        </ul>
    </nav>
</div>
```

# 复杂条件查询功能
## 分析
![](assets/markdown-img-paste-2018080317315786.png)

## 代码实现
### 页面修改`list.jsp`
![](assets/markdown-img-paste-20180803180644253.png)

### web层(service)
```java
@WebServlet("/user/serach")
public class SerachUserServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1.获取参数
        String currPage = request.getParameter("currPage");//当前页码
        String rows = request.getParameter("rows");//每页显示条数
        if(currPage == null || "".equals(currPage)){
            currPage = "1";
        }

        if(rows == null || "".equals(rows)){
            rows = "5";
        }

        //获取条件查询参数
        Map<String, String[]> condition = request.getParameterMap();

        //2.调用service查询
        UserService service = new UserServiceImpl();
        PageBean<User> pb = service.serachUsers(currPage,rows,condition);
        //3.将PageBean存入request
        request.setAttribute("pb",pb);
        //将查询条件存入request
        request.setAttribute("condition",condition);
        //4.转发到list.jsp
        request.getRequestDispatcher("/list_page_condition.jsp").forward(request,response);
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doPost(request, response);
    }
}
```
### 业务层(service)
#### 接口`UserService`
```java
/**
 * 分页查询用户信息
 * @param currPage  当前页
 * @param rows   每页显示数据行数
 * @return   分页数据
 */
PageBean<User> findUserByPage(String currPage, String rows);

/**
 * 查询用户信息
 * @param currPage  当前页
 * @param rows   每页数量
 * @param condition  查询条件
 * @return  分页数据
 */
PageBean<User> serachUsers(String currPage, String rows, Map<String,String[]> condition);
```
#### 实现类`UserServiceImpl`
```java
@Override
public PageBean<User> serachUsers(String currPage, String rows, Map<String, String[]> condition) {

    //处理参数
    int cp = Integer.parseInt(currPage);
    int rs = Integer.parseInt(rows);
    if(cp <=0) {
        cp = 1;
    }
    //2.调用dao查询总记录数
    int totalCount = userDao.findTotalCount(condition);
    //3.调用dao查询List集合
    //计算开始的记录索引
    int start = (cp - 1) * rs;
    List<User> list = userDao.findByPage(start,rs,condition);

    //4.计算总页码
    int totalPage = (int) Math.ceil(totalCount*1.0/rs);

    //5.创建空的PageBean对象
    PageBean<User> pb = new PageBean<User>();
    //6.设置分页数据
    pb.setCurrPage(cp);
    pb.setRows(rs);
    pb.setTotalCount(totalCount);
    pb.setList(list);
    pb.setTotalPage(totalPage);

    return pb;
}
```
### 数据访问层(dao)
#### 接口`UserDao`
```java
/**
 * 根据条件查询用户数量
 * @param condition
 * @return
 */
int findTotalCount(Map<String, String[]> condition);

/**
 * 根据条件查询用户信息
 * @param start
 * @param rows
 * @param condition
 * @return
 */
List<User> findByPage(int start, int rows, Map<String, String[]> condition);
```
#### 实现类`UserDaoImpl`
```java
@Override
public int findTotalCount(Map<String, String[]> condition) {
    //1.定义模板初始化sql
    String sql = "select count(*) from user where 1 = 1 ";
    StringBuilder sb = new StringBuilder(sql);
    //2.遍历map
    Set<String> keySet = condition.keySet();
    //定义参数的集合
    List<Object> params = new ArrayList<Object>();
    for (String key : keySet) {
        //排除分页条件参数
        if("currentPage".equals(key) || "rows".equals(key)){
            continue;
        }

        //获取value
        String value = condition.get(key)[0];
        //判断value是否有值
        if(value != null && !"".equals(value)){
            //有值
            sb.append(" and "+key+" like ? ");
            params.add("%"+value+"%");//？条件的值
        }
    }
    System.out.println(sb.toString());
    System.out.println(params);

    return template.queryForObject(sb.toString(),Integer.class,params.toArray());
}

@Override
public List<User> findByPage(int start, int rows, Map<String, String[]> condition) {
    String sql = "select * from user  where 1 = 1 ";

    StringBuilder sb = new StringBuilder(sql);
    //2.遍历map
    Set<String> keySet = condition.keySet();
    //定义参数的集合
    List<Object> params = new ArrayList<Object>();
    for (String key : keySet) {
        //排除分页条件参数
        if("currentPage".equals(key) || "rows".equals(key)){
            continue;
        }
        //获取value
        String value = condition.get(key)[0];
        //判断value是否有值
        if(value != null && !"".equals(value)){
            //有值
            sb.append(" and "+key+" like ? ");
            params.add("%"+value+"%");//？条件的值
        }
    }

    //添加分页查询
    sb.append(" limit ?,? ");
    //添加分页查询参数值
    params.add(start);
    params.add(rows);

    return template.query(sb.toString(),new BeanPropertyRowMapper<User>(User.class),params.toArray());
}
```
